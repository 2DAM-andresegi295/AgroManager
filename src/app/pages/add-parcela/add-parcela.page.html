<app-menu
  [contentId]="'add-parcela-content'"
  [title]="'Añadir Parcela'"
  [items]="[
    { text: 'Volver', url: '/parcelas' },
    { text: 'Guardar', url: '/parcelas' }
  ]"
></app-menu>

<div class="ion-page" id="add-parcela-content">
  <ion-header>
    <ion-toolbar>
      <ion-buttons slot="start">
        <ion-menu-button menu="add-parcela-content"></ion-menu-button>
      </ion-buttons>
      <ion-title>Añadir Parcela</ion-title>
    </ion-toolbar>
  </ion-header>

  <ion-content class="ion-padding">

    <ion-card>
      <ion-card-header>
        <ion-card-title>Datos de la Parcela</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-item>
          <ion-label position="stacked">Nombre de la parcela</ion-label>
          <ion-input [(ngModel)]="nombreParcela" type="text"></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Tipo de explotación</ion-label>
          <ion-select [(ngModel)]="tipoExplotacion" placeholder="Elige..." interface="popover">
            <ion-select-option value="agricola">Agrícola</ion-select-option>
            <ion-select-option value="ganadera">Ganadera</ion-select-option>
          </ion-select>
        </ion-item>
      </ion-card-content>
    </ion-card>

    <ion-card *ngFor="let vertice of vertices; let i = index">
      <ion-card-header>
        <ion-card-title>Vértice {{ i + 1 }}</ion-card-title>
      </ion-card-header>

      <ion-card-content>
        <ion-grid>
          <ion-row>
            <ion-col size="6">
              <ion-item>
                <ion-label position="stacked">Latitud</ion-label>
                <ion-input
                  *ngIf="i + 1 == vertices.length; else soloLecturaLat"
                  type="number"
                  [(ngModel)]="ultimoClick.lat"
                  (ionInput)="onManualInput($event)">
                </ion-input>
                <ng-template #soloLecturaLat>
                  <ion-input [value]="vertices[i].lat" readonly></ion-input>
                </ng-template>
              </ion-item>
            </ion-col>

            <ion-col size="6">
              <ion-item>
                <ion-label position="stacked">Altitud</ion-label>
                <ion-input
                  *ngIf="i + 1 == vertices.length; else soloLecturaLng"
                  type="number"
                  [(ngModel)]="ultimoClick.lng"
                  (ionInput)="onManualInput($event)">
                </ion-input>
                <ng-template #soloLecturaLng>
                  <ion-input [value]="vertices[i].lng" readonly></ion-input>
                </ng-template>
              </ion-item>
            </ion-col>
          </ion-row>
        </ion-grid>

        <div *ngIf="i + 1 == vertices.length" class="ion-padding-top">
          <ion-button expand="block" color="primary" (click)="agregarVertice()">
            <ion-icon name="add" slot="start"></ion-icon>
            Añadir
          </ion-button>

          <ion-button
            expand="block"
            color="success"
            [disabled]="!nombreParcela || !tipoExplotacion"
            (click)="crearParcela()"
            *ngIf="i > 2"
          >
            <ion-icon name="create" slot="start"></ion-icon>
            Crear parcela
          </ion-button>
        </div>
      </ion-card-content>
    </ion-card>

    <ion-card>
      <ion-card-header>
        <ion-card-title>Ubicación en el Mapa</ion-card-title>
      </ion-card-header>
      <ion-card-content class="mapa">
        <app-map
          #mapadd
          [isAdd]="true"
          (marcadorCreado)="onMarcadorCreado($event)">
        </app-map>
      </ion-card-content>
    </ion-card>

  </ion-content>
</div>
